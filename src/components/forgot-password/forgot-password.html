<v-dialog
    :model-value="modelValue"
    @update:model-value="$emit('update:modelValue', $event)"
    max-width="500px"
    persistent
  >
    <v-card class="pa-2">
      <v-card-title class="d-flex justify-space-between align-center">
        <span class="text-h5">Forgot Password</span>
        <v-btn icon="mdi-close" variant="text" @click="closeDialog"></v-btn>
      </v-card-title>
      
      <v-window v-model="step">
        <v-window-item :value="1">
          <v-card-text>
            <p class="mb-4">
              Please enter your email address. We will send you a verification code to reset your password.
            </p>
            <v-alert v-if="error" type="error" density="compact" class="mb-4">{{ error }}</v-alert>
            <v-form @submit.prevent="verifyEmail">
              <v-text-field
                v-model="email"
                label="Email Address"
                type="email"
                variant="outlined"
                prepend-inner-icon="mdi-email-outline"
                :rules="[rules.required, rules.email]"
                autofocus
              ></v-text-field>
            </v-form>
          </v-card-text>
          <v-card-actions>
            <v-spacer></v-spacer>
            <v-btn
              color="primary"
              variant="flat"
              @click="verifyEmail"
              :loading="loading"
              :disabled="!email"
            >
              Send Code
            </v-btn>
          </v-card-actions>
        </v-window-item>

        <v-window-item :value="2">
          <v-card-text>
            <p class="mb-2">
              A 6-digit verification code has been sent to:
            </p>
            <p class="font-weight-bold text-center mb-4">{{ email }}</p>
            <v-alert v-if="error" type="error" density="compact" class="mb-4">{{ error }}</v-alert>
            <v-form @submit.prevent="submitOtp">
              <v-otp-input
                v-model="otp"
                :loading="loading"
                length="6"
                variant="outlined"
                @finish="submitOtp"
              ></v-otp-input>
            </v-form>
          </v-card-text>
          <v-card-actions>
             <v-btn variant="text" @click="step = 1">Change Email</v-btn>
            <v-spacer></v-spacer>
            <v-btn
              color="primary"
              variant="flat"
              @click="submitOtp"
              :loading="loading"
              :disabled="otp.length < 6"
            >
              Verify
            </v-btn>
          </v-card-actions>
        </v-window-item>
      </v-window>
    </v-card>
  </v-dialog>