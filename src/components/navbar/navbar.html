
<v-app-bar app color="primary" dark elevation="4" class="navbar">
  <div class="d-flex align-center flex-grow-0">
    <v-img
      alt="Logo"
      class="shrink mr-2"
      contain
      :src="logoUrl"
      transition="scale-transition"
      width="40"
    />

    <v-toolbar-title class="text-h6 font-weight-bold title-text">
      {{ appTitle }}
    </v-toolbar-title>
  </div>

  <v-spacer></v-spacer>

  <!-- Desktop Navigation -->
  <v-btn
    v-for="item in navigationItems"
    :key="item.title"
    :to="item.route"
    variant="text"
    class="d-none d-md-flex mr-2"
  >
    <v-icon start>{{ item.icon }}</v-icon>
    {{ item.title }}
  </v-btn>

  <!-- Auth Section - Desktop -->
  <div class="d-none d-md-flex align-center">
    <!-- ถ้ายังไม่ login -->
    <v-btn
      v-if="!isAuthenticated"
      variant="outlined"
      color="white"
      @click="goToLogin"
      class="mr-2"
    >
      <v-icon start>mdi-login</v-icon>
      เข้าสู่ระบบ
    </v-btn>

    <!-- ถ้า login แล้ว -->
    <template v-else>
      <!-- User Avatar/Profile -->
      <v-menu offset-y>
        <template v-slot:activator="{ props }">
          <v-btn
            v-bind="props"
            variant="text"
            class="mr-2"
          >
            <v-avatar size="32" color="accent" class="mr-2">
              <v-img
                v-if="user?.avatar"
                :src="user.avatar"
                :alt="user.name"
              />
              <span v-else class="text-caption">{{ userInitials }}</span>
            </v-avatar>
            <span class="text-body-2">{{ user?.name }}</span>
            <v-icon end>mdi-chevron-down</v-icon>
          </v-btn>
        </template>
        
        <v-list>
          <v-list-item @click="goToProfile">
            <template v-slot:prepend>
              <v-icon>mdi-account</v-icon>
            </template>
            <v-list-item-title>โปรไฟล์</v-list-item-title>
          </v-list-item>
          
          <v-list-item @click="handleLogout">
            <template v-slot:prepend>
              <v-icon>mdi-logout</v-icon>
            </template>
            <v-list-item-title>ออกจากระบบ</v-list-item-title>
          </v-list-item>
        </v-list>
      </v-menu>
    </template>
  </div>

  <!-- Mobile Menu -->
  <v-app-bar-nav-icon
    @click="drawer = !drawer"
    class="d-flex d-md-none"
  ></v-app-bar-nav-icon>
</v-app-bar>

<!-- Mobile Navigation Drawer -->
<v-navigation-drawer v-model="drawer" temporary location="right" class="mobile-drawer">
  <v-list>
    <!-- Navigation Items -->
    <v-list-item
      v-for="item in navigationItems"
      :key="item.title"
      :to="item.route"
      @click="drawer = false"
    >
      <template v-slot:prepend>
        <v-icon>{{ item.icon }}</v-icon>
      </template>
      <v-list-item-title>{{ item.title }}</v-list-item-title>
    </v-list-item>

    <v-divider class="my-4"></v-divider>

    <!-- Auth Section - Mobile -->
    <!-- ถ้ายังไม่ login -->
    <v-list-item
      v-if="!isAuthenticated"
      @click="goToLogin"
    >
      <template v-slot:prepend>
        <v-icon>mdi-login</v-icon>
      </template>
      <v-list-item-title>เข้าสู่ระบบ</v-list-item-title>
    </v-list-item>

    <!-- ถ้า login แล้ว -->
    <template v-else>
      <!-- User Info -->
      <v-list-item class="user-info-item">
        <template v-slot:prepend>
          <v-avatar size="40" color="accent">
            <v-img
              v-if="user?.avatar"
              :src="user.avatar"
              :alt="user.name"
            />
            <span v-else>{{ userInitials }}</span>
          </v-avatar>
        </template>
        <v-list-item-title class="font-weight-medium">{{ user?.name }}</v-list-item-title>
        <v-list-item-subtitle>{{ user?.email }}</v-list-item-subtitle>
      </v-list-item>

      <v-list-item @click="goToProfile">
        <template v-slot:prepend>
          <v-icon>mdi-account</v-icon>
        </template>
        <v-list-item-title>โปรไฟล์</v-list-item-title>
      </v-list-item>

      <v-list-item @click="handleLogout">
        <template v-slot:prepend>
          <v-icon>mdi-logout</v-icon>
        </template>
        <v-list-item-title>ออกจากระบบ</v-list-item-title>
      </v-list-item>
    </template>
  </v-list>
</v-navigation-drawer>
